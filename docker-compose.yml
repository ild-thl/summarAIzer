version: "3.8"

services:
    moomootscribe:
        image: pascalhuerten/moomootscribe:latest
        container_name: moomootscribe
        build: .
        user: "1000:1000" # Ensure proper user mapping for file permissions
        ports:
            - "7860:7860"
        volumes:
            # Persistent storage for resources folder
            - ./resources:/app/resources
            - ./prompts:/app/prompts
            # Optional: Mount .env file for environment variables
            - ./.env:/app/.env:ro
        env_file:
            - ./.env
        environment:
            - PROXY_PATH=/moomootscribe
            - PROXY_HOST=lab.dlc.sh
            - PROXY_SCHEME=https
        restart: unless-stopped
        healthcheck:
            test: ["CMD", "curl", "-f", "http://localhost:7860/"]
            interval: 30s
            timeout: 10s
            retries: 3
            start_period: 40s
        # Optional: Resource limits
        deploy:
            resources:
                limits:
                    memory: 2G
                reservations:
                    memory: 1G

# Persistent volumes
volumes:
    moomootscribe_data:
        driver: local
